var util = require("util");
var utils = require('../utils');
var events = require('events').EventEmitter;

function Action(fn,cfg,restrict){
	events.call(this);
	this.config = cfg;
	this.func = function(req,res){
		var self = this;
		this.req = req;
		this.res = res;
		this.data = {};
		if (restrict && restrict.indexOf(req.method.toLowerCase()) === -1) {
			return res.redirect('/404.html');
		};
		if (debug) {
			return fn.call(self,req,res);
		}else{
			try{
				fn.call(self,req,res);
			}catch(e){
				console.log(e);
				res.redirect('./500.html');
			}
		}
	};
	this.on('destory',function(){
		this = null;
		delete this;
	})
};

util.inherits(Action,events);
utils.extend(Action.prototype,require('./proto'),true);

module.exports = Action;